{"version":3,"file":"parser.js","names":["parserInstance: Parser | undefined"],"sources":["../src/parser.ts"],"sourcesContent":["import Parser, { type Language, type SyntaxNode } from \"tree-sitter\";\nimport thalo from \"@rejot-dev/tree-sitter-thalo\";\nimport {\n  findErrorNodes,\n  formatParseErrors,\n  type ErrorLocation,\n  extractErrorLocations,\n} from \"./parse-errors\";\n\nlet parserInstance: Parser | undefined;\n\nconst getParser = (): Parser => {\n  if (!parserInstance) {\n    // Ensure nodeTypeInfo is an array (may be undefined if JSON import fails in some environments)\n    thalo.nodeTypeInfo ??= [];\n    parserInstance = new Parser();\n    parserInstance.setLanguage(thalo as unknown as Language);\n  }\n  return parserInstance;\n};\n\nexport const parseThalo = (source: string): Parser.Tree => {\n  return getParser().parse(source);\n};\n\n// Re-export for external use\nexport { findErrorNodes, formatParseErrors, type ErrorLocation, extractErrorLocations };\n\n// Extended root node type that includes parse metadata\nexport interface ThaloRootNode extends SyntaxNode {\n  _thaloSource?: string;\n  _thaloFilepath?: string;\n  _thaloHasErrors?: boolean;\n}\n\ninterface ParserOptions {\n  filepath?: string;\n}\n\nexport const parser = {\n  parse: (text: string, options?: ParserOptions): ThaloRootNode => {\n    const tree = parseThalo(text);\n    const rootNode = tree.rootNode as ThaloRootNode;\n\n    // Attach metadata to root node for printer to access\n    rootNode._thaloSource = text;\n    rootNode._thaloFilepath = options?.filepath;\n    rootNode._thaloHasErrors = tree.rootNode.hasError;\n\n    // Don't throw - let printer handle ERROR nodes gracefully\n    return rootNode;\n  },\n  astFormat: \"thalo-ast\",\n  locStart: (node: SyntaxNode) => node.startIndex,\n  locEnd: (node: SyntaxNode) => node.endIndex,\n};\n"],"mappings":";;;;AASA,IAAIA;AAEJ,MAAM,kBAA0B;AAC9B,KAAI,CAAC,gBAAgB;AAEnB,QAAM,iBAAiB,EAAE;AACzB,mBAAiB,IAAI,QAAQ;AAC7B,iBAAe,YAAY,MAA6B;;AAE1D,QAAO;;AAGT,MAAa,cAAc,WAAgC;AACzD,QAAO,WAAW,CAAC,MAAM,OAAO;;AAiBlC,MAAa,SAAS;CACpB,QAAQ,MAAc,YAA2C;EAC/D,MAAM,OAAO,WAAW,KAAK;EAC7B,MAAM,WAAW,KAAK;AAGtB,WAAS,eAAe;AACxB,WAAS,iBAAiB,SAAS;AACnC,WAAS,kBAAkB,KAAK,SAAS;AAGzC,SAAO;;CAET,WAAW;CACX,WAAW,SAAqB,KAAK;CACrC,SAAS,SAAqB,KAAK;CACpC"}